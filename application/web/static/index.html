<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Kafka Web Client</title>
    <link rel="stylesheet" href="bulma@0.8.0.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js"
            integrity="sha256-yr4fRk/GU1ehYJPAs8P4JlTgu0Hdsp4ZKrx8bDEDC3I=" crossorigin="anonymous"></script>
    <script type="text/javascript" charset="utf-8">
        const MAX_NUMBER_OF_MESSAGES = 50

        function getElement(id) {
            return document.getElementById(id)
        }

        function clearTable() {
            const table = getElement("messages-table")
            const body = table.getElementsByTagName('tbody')[0]
            table.replaceChild(document.createElement('tbody'), body)
        }

        function addInTable(message) {
            const table = getElement("messages-table")
            const body = table.getElementsByTagName('tbody')[0]
            const row = body.insertRow()

            row.insertCell(0).appendChild(document.createTextNode(message.index))
            row.insertCell(1).appendChild(document.createTextNode(message.offset))
            row.insertCell(2).appendChild(document.createTextNode(message.timestamp))
            row.insertCell(3).appendChild(document.createTextNode(message.value))
        }

        const socket = io()

        socket.on('connect', function () {
            console.log('socket: connect')
        })

        socket.on('consumed-message', function (message) {
            console.log('socket: consumed-message', message)
            getElement("messages-table").style.display = null
            getElement("progress-bar").value += 100 / MAX_NUMBER_OF_MESSAGES
            addInTable(message)
        })

        socket.on('end', function () {
            console.log('socket: end')
            getElement("progress-bar").value = 100
            getElement("start-button").className = getElement("start-button").className.replace(" is-loading", "")
        })

        const onStartButtonClick = function () {
            console.log("start-button: click")
            getElement("start-button").className += " is-loading"
            getElement("progress-bar").value = 0
            getElement("messages-table").style.display = 'none'
            clearTable()
            socket.emit('start', {
                cluster: 'localhost:9092',
                topic: 'mytopic',
                max_messages: MAX_NUMBER_OF_MESSAGES
            })
        }

        function onLoad() {
            console.log("onLoad()")
            getElement("start-button").addEventListener("click", onStartButtonClick)
        }
    </script>
</head>
<body onload="onLoad()">
<section class="hero is-primary is-info">
    <div class="hero-body">
        <h1 class="title"> Kafka Web Client </h1>
    </div>
</section>
<section class="section">
    <div class="container">
        <div class="content">
            <p>Click on <i>Start</i> to fetch up to 50 messages from <b>localhost:9092</b></p>
            <button id="start-button" class="button is-primary">Start</button>
        </div>
        <div class="content">
            <progress id="progress-bar" class="progress is-primary" value="0" max="100">progress</progress>
        </div>
        <div class="content">
            <table id="messages-table" class="table" style="display: none">
                <thead>
                <tr>
                    <th>Index</th>
                    <th>Offset</th>
                    <th>Time</th>
                    <th>Value</th>
                </tr>
                </thead>
                <tfoot>
                <tr>
                    <th>Index</th>
                    <th>Offset</th>
                    <th>Time</th>
                    <th>Value</th>
                </tr>
                </tfoot>
                <tbody></tbody>
            </table>
        </div>
    </div>
</section>
</body>
</html>